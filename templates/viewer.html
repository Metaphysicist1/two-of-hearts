<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ðŸ’Œ A Special Message for You</title>

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;900&family=Inter:wght@300;400;500;600;700&display=swap"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        font-family: "Inter", sans-serif;
        background: linear-gradient(
          135deg,
          #0f0e1a 0%,
          #1a1433 30%,
          #2a1a4a 60%,
          #3a1f5f 100%
        );
        color: #fff;
        overflow: hidden;
      }

      /* Envelope screen */
      #envelope-screen {
        position: fixed;
        inset: 0;
        z-index: 200;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #1a0f2e, #2a1a4a);
      }

      .envelope {
        position: relative;
        width: 280px;
        height: 200px;
        perspective: 1200px;
        cursor: pointer;
      }

      .flap {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 100px;
        background: linear-gradient(to bottom, #ff69b4, #ff1493);
        transform-origin: bottom;
        transform: rotateX(0deg);
        transition: transform 1.3s ease;
        border-radius: 140px 140px 0 0 / 100px 100px 0 0;
        box-shadow: 0 10px 30px rgba(255, 20, 147, 0.4);
      }

      .envelope.open .flap {
        transform: rotateX(180deg);
      }

      .pocket {
        position: absolute;
        bottom: 0;
        left: 10px;
        right: 10px;
        height: 140px;
        background: #fff0f5;
        border: 2px solid #ff69b4;
        border-radius: 0 0 20px 20px;
        box-shadow: inset 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .heart-seal {
        position: absolute;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 68px;
        color: #fff;
        text-shadow: 0 0 20px rgba(255, 20, 147, 0.8);
        z-index: 10;
        pointer-events: none;
      }

      .envelope.open .heart-seal {
        animation: fadeOut 0.8s forwards 0.7s;
      }

      @keyframes fadeOut {
        to {
          opacity: 0;
          transform: scale(0.5) translate(-50%, -50%);
        }
      }

      .envelope-text {
        margin-top: 40px;
        font-size: 1.4rem;
        color: #ffb3c6;
        text-align: center;
        text-shadow: 0 2px 12px rgba(255, 105, 180, 0.6);
      }

      /* Main content */
      #main-content {
        position: relative;
        z-index: 10;
        opacity: 0;
        transition: opacity 1.2s ease 1.2s;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 12px;
      }

      #main-content.visible {
        opacity: 1;
      }

      .letter-container {
        position: relative;
        width: 100%;
        max-width: 540px;
        background: rgba(40, 20, 70, 0.18);
        backdrop-filter: blur(14px);
        border: 1px solid rgba(255, 105, 180, 0.15);
        border-radius: 28px;
        padding: 32px 26px 36px;
        box-shadow:
          0 16px 50px rgba(0, 0, 0, 0.55),
          inset 0 0 40px rgba(255, 105, 180, 0.08);
        overflow: hidden;
      }

      .letter-header {
        font-size: clamp(19px, 5.2vw, 23px);
        font-weight: 400;
        letter-spacing: 1.8px;
        margin-bottom: 20px;
        color: rgba(255, 230, 240, 0.94);
        text-align: center;
        text-shadow: 0 2px 10px rgba(255, 105, 180, 0.4);
      }

      .letter-message {
        font-size: clamp(15.5px, 4.3vw, 17.5px);
        line-height: 1.82;
        text-align: center;
        color: #fff0f5;
        margin: 20px 0 30px;
        white-space: pre-wrap;
        word-wrap: break-word;
        font-weight: 400;
        letter-spacing: 0.2px;
        background: linear-gradient(
          135deg,
          #ffe4e9 0%,
          #fff0f5 50%,
          #ffe4e9 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 2px 8px rgba(255, 105, 180, 0.35));
        padding: 0 12px;
      }

      .photo-wrapper {
        width: 100%;
        max-width: 320px;
        aspect-ratio: 3/4;
        margin: 18px auto 24px;
        overflow: hidden;
        border-radius: 16px;
        box-shadow: 0 10px 36px rgba(255, 105, 180, 0.32);
        background: rgba(0, 0, 0, 0.25);
      }

      .letter-photo {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
      }

      .letter-signature {
        text-align: right;
        margin-top: 24px;
        font-family: "Playfair Display", serif;
        font-size: clamp(28px, 7.5vw, 36px);
        background: linear-gradient(135deg, #ff4da6, #ff8fab, #ffb3c6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 3px 12px rgba(255, 77, 166, 0.45));
      }

      .action-buttons {
        display: flex;
        justify-content: center;
        margin-top: 28px;
      }

      .btn {
        padding: 14px 40px;
        border: none;
        border-radius: 16px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        background: linear-gradient(135deg, #ff4da6, #ff8fab);
        color: white;
        box-shadow: 0 6px 20px rgba(255, 77, 166, 0.4);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 32px rgba(255, 77, 166, 0.6);
      }

      .btn.copied {
        background: linear-gradient(135deg, #64ff8a, #39ff14);
        box-shadow: 0 8px 24px rgba(100, 255, 138, 0.5);
      }

      .btn .icon {
        font-size: 1.3rem;
      }

      /* Music toggle */
      #musicToggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 100;
        background: rgba(255, 105, 180, 0.25);
        backdrop-filter: blur(8px);
        border-radius: 50%;
        width: 54px;
        height: 54px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);
        font-size: 1.6rem;
        border: 1px solid rgba(255, 182, 193, 0.4);
        transition: all 0.3s;
        opacity: 0;
        pointer-events: none;
      }

      #heartsCanvas {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 5; /* behind content but above background */
        opacity: 0;
        transition: opacity 1.5s ease;
      }

      #heartsCanvas.visible {
        opacity: 1;
      }

      #musicToggle.visible {
        opacity: 1;
        pointer-events: auto;
      }

      #musicToggle.playing {
        background: rgba(255, 20, 147, 0.45);
        transform: scale(1.1);
      }

      /* Mobile */
      @media (max-width: 640px) {
        .letter-container {
          max-width: 92vw;
          padding: 28px 22px 34px;
        }
        .photo-wrapper {
          max-width: 290px;
          margin: 16px auto 20px;
        }
        .btn {
          padding: 16px 50px;
          font-size: 1.05rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Envelope intro -->
    <div id="envelope-screen">
      <div class="envelope" id="envelope">
        <div class="flap"></div>
        <div class="pocket"></div>
        <div class="heart-seal">ðŸ’ž</div>
      </div>
      <div class="envelope-text">Tap to open your valentine â™¡</div>
    </div>

    <!-- Main content -->
    <div id="main-content">
      <div class="letter-container">
        <div class="letter-header">Dear <strong>{{ name }}</strong>,</div>

        {% if photo %}
        <div class="photo-wrapper">
          <img src="{{ photo }}" alt="Shared moment" class="letter-photo" />
        </div>
        {% endif %}

        <p class="letter-message">{{ message }}</p>

        <div class="letter-signature">With love,<br />{{ sender }}</div>

        <div class="action-buttons">
          <button class="btn" id="copyBtn">
            <span class="icon">ðŸ“‹</span> Copy Link
          </button>
        </div>
      </div>
    </div>

    <!-- Music -->
    <audio id="bgMusic" loop preload="auto">
      <source src="billie-eilish-wildflower.mp3" type="audio/mpeg" />
    </audio>

    <div id="musicToggle">â™«</div>

    <!-- Hearts -->
    <canvas id="heartsCanvas"></canvas>

    <script>
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Envelope â†’ reveal + start music & hearts
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const envelopeScreen = document.getElementById("envelope-screen");
      const envelope = document.getElementById("envelope");
      const mainContent = document.getElementById("main-content");
      const musicToggle = document.getElementById("musicToggle");
      const music = document.getElementById("bgMusic");

      music.volume = 0.28;

      envelopeScreen.addEventListener("click", () => {
        envelope.classList.add("open");

        setTimeout(() => {
          envelopeScreen.style.display = "none";
          mainContent.style.opacity = "1";
          musicToggle.classList.add("visible");
          document.getElementById("heartsCanvas").classList.add("visible");

          // Start music (gesture already happened)
          music.muted = false;
          music
            .play()
            .then(() => {
              musicToggle.classList.add("playing");
              musicToggle.textContent = "â™ª";
            })
            .catch((e) => console.log("Audio play failed", e));
        }, 1400);
      });

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Copy button
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      document.getElementById("copyBtn").addEventListener("click", () => {
        navigator.clipboard
          .writeText(window.location.href)
          .then(() => {
            const btn = document.getElementById("copyBtn");
            btn.classList.add("copied");
            btn.innerHTML = '<span class="icon">ðŸ’–</span> Copied!';
            setTimeout(() => {
              btn.classList.remove("copied");
              btn.innerHTML = '<span class="icon">ðŸ“‹</span> Copy Link';
            }, 2500);
          })
          .catch(() => {
            alert("Copy manually:\n" + window.location.href);
          });
      });

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Music toggle
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      let isPlaying = false;
      musicToggle.addEventListener("click", (e) => {
        e.stopPropagation();
        if (isPlaying) {
          music.pause();
          musicToggle.textContent = "â™«";
          musicToggle.classList.remove("playing");
        } else {
          music
            .play()
            .then(() => {
              musicToggle.textContent = "â™ª";
              musicToggle.classList.add("playing");
            })
            .catch(() => {
              alert("Tap anywhere first to allow music â™¡");
            });
        }
        isPlaying = !isPlaying;
      });

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Floating hearts
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const canvas = document.getElementById("heartsCanvas");
      const ctx = canvas.getContext("2d");

      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener("resize", resize);

      const hearts = [];
      const symbols = ["â™¥", "ðŸ’•", "ðŸ’–", "ðŸ’—", "ðŸ’ž", "ðŸ’“"];
      const colors = [
        "#ff4da6",
        "#ff8fab",
        "#ffb3c6",
        "#ff77aa",
        "#ff99cc",
        "#ffccdd",
      ];

      class Heart {
        constructor() {
          this.reset();
        }
        reset() {
          this.x = Math.random() * canvas.width;
          this.y = canvas.height + 40;
          this.size = Math.random() * 22 + 14;
          this.speedY = Math.random() * 1.6 + 0.9;
          this.speedX = (Math.random() - 0.5) * 1.4;
          this.symbol = symbols[Math.floor(Math.random() * symbols.length)];
          this.color = colors[Math.floor(Math.random() * colors.length)];
          this.opacity = Math.random() * 0.45 + 0.45;
          this.rotation = Math.random() * Math.PI * 2;
          this.rotationSpeed = (Math.random() - 0.5) * 0.04;
        }
        update() {
          this.y -= this.speedY;
          this.x += this.speedX;
          this.rotation += this.rotationSpeed;
          if (this.y < -50) this.reset();
        }
        draw() {
          ctx.save();
          ctx.globalAlpha = this.opacity;
          ctx.font = `${this.size}px Arial, sans-serif`;
          ctx.fillStyle = this.color;
          ctx.translate(this.x, this.y);
          ctx.rotate(this.rotation);
          ctx.fillText(this.symbol, 0, 0);
          ctx.restore();
        }
      }

      function initHearts() {
        hearts.length = 0;
        const count = Math.max(20, Math.round(window.innerWidth / 35) * 4);
        for (let i = 0; i < count; i++) hearts.push(new Heart());
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        hearts.forEach((h) => {
          h.update();
          h.draw();
        });
        requestAnimationFrame(animate);
      }

      initHearts();
      animate();
    </script>
  </body>
</html>
